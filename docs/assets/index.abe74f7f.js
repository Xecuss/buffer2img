var X=Object.defineProperty;var Y=(i,e,t)=>e in i?X(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var C=(i,e,t)=>(Y(i,typeof e!="symbol"?e+"":e,t),t);import{z as Z,S as x,i as ee,s as te,e as p,a as O,b as h,c as _,d as b,f as L,g as w,l as B,n as R,r as le,t as ie,h as se,u as ne}from"./vendor.c9de15f8.js";const re=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerpolicy&&(n.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?n.credentials="include":l.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(l){if(l.ep)return;l.ep=!0;const n=t(l);fetch(l.href,n)}};re();const H=async i=>{const e=new FileReader;return new Promise(t=>{e.readAsArrayBuffer(i),e.onload=s=>{t(s.target.result)}})},T=i=>{let e=new Blob([i]);return URL.createObjectURL(e)},oe=async i=>{const e=new Image;return new Promise(t=>{e.src=i,e.onload=s=>{const{height:l,width:n}=e;t({height:l,width:n,img:e})}})},ce=async i=>{const e=$(),{height:t,width:s,img:l}=await oe(i);return e.height=t,e.width=s,e.getContext("2d").drawImage(l,0,0,s,t),e};let F=null;const $=()=>F||(F=document.createElement("canvas")),ae=async i=>new Promise(e=>{i.toBlob(t=>{e(URL.createObjectURL(t))},"image/png",.1)});function fe(i){const e=[];e.push(...M(1)),e.push(...M(i.length));for(let t of i)e.push(...M(t.size));return e}function ue(i){let e=0;const[t,s]=j(i);e+=t;const[l,n]=j(i.slice(e));e+=l;const a=[];let u=0;for(;u<n;){let[d,g]=j(i.slice(e));e+=d,a.push(g),u++}return{version:s,fileNum:n,fileSizes:a,offset:e}}function M(i){let e=i.toString(2);const t=[];for(;e.length>0;){const s=e.slice(-7);e=e.slice(0,-7);let l="0";e.length&&(l="1");const n=parseInt(s+l,2);t.push(n)}return t}function j(i){let e="",t=0;for(let s of i){t++;const l=("00000000"+s.toString(2)).slice(-8),n=l.slice(-1);if(e=l.slice(0,-1)+e,n==="0")break}return[t,parseInt(e,2)]}class de{constructor(){C(this,"width");C(this,"height");C(this,"realPixel");C(this,"data");C(this,"targetFiles");C(this,"inited",!1)}async init(e){const t=fe(e),s=[];let l=0;for(let g of e){const c=await H(g),o=new Uint8Array(c);console.log(`fileName: ${g.name}: ${g.size} - ${o.length}`),s.push(o),l+=o.length}let n=new Uint8Array(t.length+l);n.set(t);let a=t.length;s.forEach(g=>{n.set(g,a),a+=g.length});const u=Z(n,{level:9}),d=M(u.length);console.log(d),console.log(u.slice(-8)),this.data=new Uint8Array(d.length+u.length),this.data.set(d),this.data.set(u,d.length),console.log(this.data.slice(0,12)),this.realPixel=Math.floor(this.data.length/3)+1,this.width=Math.floor(Math.sqrt(this.realPixel)),this.height=Math.round(Math.floor(this.realPixel/this.width)+1),this.inited=!0}getPixel(e,t){if(e>this.width)throw new Error("out of range");const s=(t*this.width+e)*3,[l=0,n=0,a=0]=this.data.slice(s,s+3);return{r:l,g:n,b:a}}}function K(i){let e,t;return{c(){e=p("img"),O(e.src,t=i[0][0])||h(e,"src",t),h(e,"alt","\u539F\u56FE"),h(e,"class","src-img svelte-63uibi")},m(s,l){_(s,e,l)},p(s,l){l&1&&!O(e.src,t=s[0][0])&&h(e,"src",t)},d(s){s&&b(e)}}}function V(i){let e,t,s,l,n,a;return{c(){e=p("div"),t=p("button"),t.textContent="\u7F16\u7801",s=L(),l=p("button"),l.textContent="\u89E3\u7801",h(t,"class","svelte-63uibi"),h(l,"class","svelte-63uibi"),h(e,"class","operate svelte-63uibi")},m(u,d){_(u,e,d),w(e,t),w(e,s),w(e,l),n||(a=[B(t,"click",i[7]),B(l,"click",i[5])],n=!0)},p:R,d(u){u&&b(e),n=!1,le(a)}}}function G(i){let e,t,s,l,n,a,u,d,g,c=i[2]<i[1].length&&J(i),o=i[2]>0&&Q(i);return{c(){e=p("img"),s=L(),l=p("a"),n=ie("\u4E0B\u8F7D\u56FE\u7247"),u=L(),c&&c.c(),d=L(),o&&o.c(),g=se(),O(e.src,t=i[1][i[2]])||h(e,"src",t),h(e,"alt","\u7ED3\u679C"),h(e,"class","src-img svelte-63uibi"),h(l,"href",a=i[1][i[2]]),h(l,"download","")},m(r,f){_(r,e,f),_(r,s,f),_(r,l,f),w(l,n),_(r,u,f),c&&c.m(r,f),_(r,d,f),o&&o.m(r,f),_(r,g,f)},p(r,f){f&6&&!O(e.src,t=r[1][r[2]])&&h(e,"src",t),f&6&&a!==(a=r[1][r[2]])&&h(l,"href",a),r[2]<r[1].length?c?c.p(r,f):(c=J(r),c.c(),c.m(d.parentNode,d)):c&&(c.d(1),c=null),r[2]>0?o?o.p(r,f):(o=Q(r),o.c(),o.m(g.parentNode,g)):o&&(o.d(1),o=null)},d(r){r&&b(e),r&&b(s),r&&b(l),r&&b(u),c&&c.d(r),r&&b(d),o&&o.d(r),r&&b(g)}}}function J(i){let e,t,s;return{c(){e=p("a"),e.textContent="\u4E0B\u4E00\u5F20",h(e,"href","javascript:void(0);")},m(l,n){_(l,e,n),t||(s=B(e,"click",i[8]),t=!0)},p:R,d(l){l&&b(e),t=!1,s()}}}function Q(i){let e,t,s;return{c(){e=p("a"),e.textContent="\u4E0A\u4E00\u5F20",h(e,"href","javascript:void(0);")},m(l,n){_(l,e,n),t||(s=B(e,"click",i[9]),t=!0)},p:R,d(l){l&&b(e),t=!1,s()}}}function he(i){let e,t,s,l,n,a,u,d,g,c=i[0].length&&K(i),o=i[0]&&V(i),r=i[1].length&&G(i);return{c(){e=p("main"),t=p("div"),s=p("input"),l=L(),c&&c.c(),n=L(),o&&o.c(),a=L(),u=p("div"),r&&r.c(),h(s,"type","file"),s.multiple=!0,h(t,"class","left block svelte-63uibi"),h(u,"class","right block svelte-63uibi"),h(e,"id","main"),h(e,"class","svelte-63uibi")},m(f,m){_(f,e,m),w(e,t),w(t,s),w(t,l),c&&c.m(t,null),w(e,n),o&&o.m(e,null),w(e,a),w(e,u),r&&r.m(u,null),d||(g=B(s,"input",i[6]),d=!0)},p(f,[m]){f[0].length?c?c.p(f,m):(c=K(f),c.c(),c.m(t,null)):c&&(c.d(1),c=null),f[0]?o?o.p(f,m):(o=V(f),o.c(),o.m(e,a)):o&&(o.d(1),o=null),f[1].length?r?r.p(f,m):(r=G(f),r.c(),r.m(u,null)):r&&(r.d(1),r=null)},i:R,o:R,d(f){f&&b(e),c&&c.d(),o&&o.d(),r&&r.d(),d=!1,g()}}}function ge(i,e,t){let s,l=[],n=[],a=0,u=new de;const d=async m=>{const v=$(),k=v.getContext("2d"),{width:P,height:z,realPixel:E}=m;v.width=P,v.height=z,k.clearRect(0,0,P,z),console.log("start draw");for(let S=0;S<=z;S++)for(let A=0;A<=P;A++){const{r:q,g:N,b:D}=m.getPixel(A,S),U=`rgb(${q}, ${N}, ${D})`;k.fillStyle=U,k.fillRect(A,S,1,1)}console.log("draw finished!");let I=await ae(v);n.push(I),t(1,n),console.log(n.length)};return[l,n,a,u,d,async()=>{const m=await ce(l[0]),{height:v,width:k}=m,P=m.getContext("2d"),{data:z}=P.getImageData(0,0,k,v),E=[];for(let y=0;y<z.length;y+=4)E.push(...z.slice(y,y+3));const I=Uint8Array.from(E),[S,A]=j(I),q=I.slice(S,A+S),N=ne(q),D=ue(N);let U=D.offset;for(let y=0;y<D.fileNum;y++){const W=N.slice(U,D.fileSizes[y]+U);n.push(T(W.buffer)),U+=D.fileSizes[y]}t(1,n)},async m=>{const v=m.currentTarget.files,k=v[0];s=await H(k),l.push(T(s)),t(0,l),await u.init(v)},()=>d(u),()=>t(2,a++,a),()=>t(2,a--,a)]}class me extends x{constructor(e){super();ee(this,e,ge,he,te,{})}}new me({target:document.getElementById("app")});
